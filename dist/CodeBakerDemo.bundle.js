var CodeBakerDemo=(()=>{var N=Object.defineProperty;var H=(o,t)=>{for(var e in t)N(o,e,{get:t[e],enumerable:!0})};var T={};H(T,{Action:()=>u,Button:()=>m,ButtonProcessor:()=>c,Column:()=>p,FormConfigurator:()=>y,FormController:()=>A,IndexedDBManager:()=>R,InputField:()=>g,Registry:()=>D,RowAction:()=>_,RowButton:()=>L,RowButtonProcessor:()=>I,SubmitAction:()=>E,SubmitFormButtonProcessor:()=>B,TableConfiguratorBase:()=>v,TextAreaField:()=>w});var h=class{constructor(t,e,r){this.key=t,this.label=e,this.placeholder=r,this.element=null}getElement(){return this.element}getValue(){return this.element.value}setValue(t){return t!==null&&this.element&&(this.element.value=t),this}reset(){return this.setValue(""),this}render(){let t=document.createElement("input");return t.type="text",t.placeholder=this.placeholder??"",t}renderField(){let t=document.createElement("div");t.classList.add("field");let e=document.createElement("label");e.innerText=this.label+":",t.appendChild(e);let r=document.createElement("div");return r.classList.add("field-wrapper"),this.element=this.render(),r.appendChild(this.element),t.appendChild(r),t}};var g=class extends h{};var w=class extends h{render(){let t=document.createElement("textarea");return t.placeholder=this.placeholder??"",t}};var C=class extends h{render(){let t=document.createElement("input");return t.type="hidden",t.placeholder=this.placeholder??"",t}renderField(){return this.element=this.render()}};var b=class{constructor(t,e){this.fields=t,this.buttons=e,this.isRendered=!1,this.formContainer=null,this.onClickCallback=()=>{},this.isDone=!1}render(){if(this.isRendered)return this.formContainer;this.formContainer=document.createElement("div"),this.formContainer.classList.add("code-baker-demo-form-container");let t=document.createElement("a");t.classList.add("close"),t.href="#",t.onclick=()=>this.hide(),t.innerHTML="x";let e=document.createElement("h2");e.innerText="Form";let r=document.createElement("div");r.classList.add("inner"),this.formContainer.appendChild(t),this.formContainer.appendChild(r),r.appendChild(e);let i=document.createElement("div");i.classList.add("fields"),this.fields.forEach(s=>{i.appendChild(s.renderField())}),r.appendChild(i);let n=document.createElement("div");return n.classList.add("buttons"),this.buttons.forEach(s=>{n.appendChild(s.render())}),r.appendChild(n),document.body.appendChild(this.formContainer),this.isRendered=!0,this.formContainer}onClick(t){this.onClickCallback=t}getData(){let t={};return this.fields.forEach(e=>{t[e.key]=e.getValue()}),t}setData(t){this.fields.forEach(e=>{e.setValue(t[e.key]??null)})}reset(){this.fields.forEach(t=>{t.reset()})}resetAndHide(){this.reset(),this.hide()}hide(){this.formContainer.classList.remove("show")}done(){this.fields.prepend(new C("id","ID")),this.isDone=!0}show(t=null){this.isDone||this.done(),this.render(),this.reset(),t&&this.setData(t),this.formContainer.classList.add("show")}};var d=class{constructor(){this.items=[]}add(t){return this.items.push(t),this}prepend(t){this.items.unshift(t)}get(t){return typeof t=="number"?this.items[t]||null:this.items.find(e=>e.id===t||e.key===t)||null}remove(t){if(typeof t=="number")t>=0&&t<this.items.length&&this.items.splice(t,1);else{let e=this.items.findIndex(r=>r.id===t||r.key===t);e!==-1&&this.items.splice(e,1)}return this}setItems(t){return Array.isArray(t)&&(this.items=t),this}getItems(){return this.items}forEach(t){for(let e of this.items)t(e)}getLength(){return this.items.length}};var x=class{constructor(){this.fields=new d,this.buttons=new d}addField(t){return this.fields.add(t),this}addButton(t){return this.buttons.add(t),this}createForm(){return new b(this.fields,this.buttons)}};var y=class{constructor(t,e,r){this.pageController=t,this.formController=e,this.registry=r}getPageController(){return this.pageController}getFormController(){return this.formController}getBuilder(){let t=new x;return this.configureFields(t),this.configureButtons(t),t}configureFields(t){}configureButtons(t){}};var m=class{constructor(t){this.label=t,this.processor=null}render(){let t=document.createElement("button");return t.textContent=this.label,t.onclick=()=>this.onClick(),t}onClick(){this.getProcessor().handle()}setProcessor(t){return this.processor=t,this}getProcessor(){return this.processor}};var c=class{constructor(t){this.controller=t}getController(){return this.controller}setController(t){return this.controller=t,this}setAction(t){return this.action=t,this}getAction(){return this.action}handle(){}};var B=class extends c{constructor(t,e){super(t),this.formController=e}getPageController(){return this.controller}getFormController(){return this.formController}handle(){let t=this.getFormController().getForm(),e=t.getData();this.getAction().setFormData(e).execute(),t.resetAndHide(),this.getPageController().refresh()}};var u=class{constructor(t){this.registry=t}execute(){}};var E=class extends u{setFormData(t){return this.formData=t,this}getFormData(){return this.formData}async updateRecord(t){await this.registry.db.add(this.registry.store,t)}async createRecord(t){await this.registry.db.update(this.registry.store,t)}execute(){let t=this.getFormData();t.id?this.createRecord(t):(delete t.id,this.updateRecord(t))}};var R=class{constructor(t,e=1){this.dbName=t,this.version=e,this.db=null,this.storesToCreate=new Set}addStore(t,e={keyPath:"id",autoIncrement:!0}){this.storesToCreate.add({storeName:t,options:e})}async open(){return new Promise((t,e)=>{let r=indexedDB.open(this.dbName,this.version);r.onupgradeneeded=i=>{let n=i.target.result;this.storesToCreate.forEach(({storeName:s,options:a})=>{n.objectStoreNames.contains(s)||n.createObjectStore(s,a)})},r.onsuccess=i=>{this.db=i.target.result,t(this.db)},r.onerror=i=>e(i.target.error)})}_store(t,e="readonly"){if(!this.db)throw new Error("Database not open. Call open() before using the database.");return this.db.transaction(t,e).objectStore(t)}add(t,e){return new Promise((r,i)=>{let s=this._store(t,"readwrite").add(e);s.onsuccess=()=>r(s.result),s.onerror=()=>i(s.error)})}getAll(t){return new Promise((e,r)=>{let n=this._store(t,"readonly").getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>r(n.error)})}get(t,e){return new Promise((r,i)=>{let n=this._store(t,"readonly"),s=e;typeof e=="string"&&!isNaN(e)&&(s=Number(e));let a=n.get(s);a.onsuccess=()=>{a.result===void 0?r(null):r(a.result)},a.onerror=()=>i(a.error)})}update(t,e){return new Promise((r,i)=>{if(!e||e.id===void 0)return i(new Error("Data object must have an id property"));let n=this._store(t,"readwrite"),s=e.id;typeof e.id=="string"&&!isNaN(e.id)&&(s=Number(e.id),e={...e,id:s});let a=n.get(s);a.onsuccess=()=>{if(a.result===void 0)return i(new Error(`Record with id ${e.id} not found in ${t}`));let l=n.put(e);l.onsuccess=()=>r(l.result),l.onerror=()=>i(l.error)},a.onerror=()=>i(a.error)})}delete(t,e){return new Promise((r,i)=>{let s=this._store(t,"readwrite").delete(e);s.onsuccess=()=>r(!0),s.onerror=()=>i(s.error)})}clearAll(t){return new Promise((e,r)=>{let n=this._store(t,"readwrite").clear();n.onsuccess=()=>e(!0),n.onerror=()=>r(n.error)})}};var D=class{constructor(t,e){this.db=t,this.store=e}};var _=class extends u{constructor(t,e){super(t),this.rowOptions=e}};var L=class extends m{constructor(t,e){super(t),this.options=e}};var I=class extends c{constructor(t,e){super(t),this.rowOptions=e}setRowOptions(t){return this.rowOptions=t,this}getRowOptions(){return this.rowOptions}handle(){}};var p=class{constructor(t,e){this._key=t,this._label=e,this.rowData=null}getKey(){return this._key}setKey(t){return this._key=t,this}getLabel(){return this._label}setLabel(t){return this._label=t,this}setRowData(t){return this.rowData=t,this}getRowData(){return this.rowData}render(t){return t.innerText=this.rowData[this._key]??"",null}};var F=class extends p{setRowButtons(t){return this.rowButtons=t,this}render(t){let e=this.getRowData();if(this.rowButtons&&this.rowButtons.getLength()>0){let r=document.createElement("div");return this.rowButtons.forEach(i=>{let n=i(e),s=n.onClickCallback;r.appendChild(n.render())}),r}return null}};var k=class{constructor(t){this.containerId=t,this.columns=null,this.data=null,this.buttons=null,this.rowButtons=null,this.idToRow={}}setColumns(t){return this.columns=t,this}getColumns(){return this.columns}setButtons(t){return this.buttons=t,this}getButtons(){return this.buttons}setRowButtons(t){return this.rowButtons=t,this}getRowButtons(){return this.rowButtons}setData(t){return this.data=t,t.forEach(e=>{this.idToRow[e.id]=e}),this}getData(){return this.data}getRowData(t){return this.idToRow[t]}refresh(){this.render()}done(){return this.rowButtons.getLength()>0&&this.columns.add(new F("actions","Actions").setRowButtons(this.rowButtons)),this}render(){if(!this.columns||!this.data){console.error("Columns and data must be set before rendering.");return}let t=document.createElement("div");t.classList.add("buttons"),this.buttons.forEach(a=>{t.appendChild(a.render())});let e=document.createElement("table");e.classList.add("code-baker-demo-table");let r=document.createElement("thead"),i=document.createElement("tr");this.columns.forEach(a=>{let l=document.createElement("th");l.innerText=a.getLabel(),i.appendChild(l)}),r.appendChild(i),e.appendChild(r);let n=document.createElement("tbody");this.data.forEach(a=>{let l=document.createElement("tr");this.columns.forEach(q=>{let f=document.createElement("td");f.classList.add(q.getKey()),q.setRowData(a);let O=q.render(f);O&&f.appendChild(O),l.appendChild(f)}),n.appendChild(l)}),e.appendChild(n);let s=document.getElementById(this.containerId);s?(s.classList.add("code-baker-demo-table-container"),s.innerHTML="",s.appendChild(t),s.appendChild(e)):console.error(`Container with id "${this.containerId}" not found.`)}};var P=class{constructor(t){this._containerId=t,this._columns=new d,this._buttons=new d,this._rowButtons=new d}getContainerId(){return this._containerId}addColumn(t){return this._columns.add(t),this}addButton(t){return this._buttons.add(t),this}addRowButton(t){return this._rowButtons.add(t),this}setContainerId(t){return this._containerId=t,this}setColumns(t){return this._columns=t,this}setButtons(t){return this._buttons=t,this}setRowButtons(t){return this._rowButtons=t,this}createTable(){return new k(this.getContainerId()).setColumns(this._columns).setButtons(this._buttons).setRowButtons(this._rowButtons).done()}};var v=class{constructor(t,e,r){this.containerId=r,this.registry=e,this.controller=t}getContainerId(){return this.containerId}setContainerId(t){return this.containerId=t,this}getController(){return this.controller}getBuilder(){let t=new P(this.getContainerId());return this.configureColumns(t),this.configureButtons(t),this.configureRowButtons(t),t}configureRowButtons(t){}configureButtons(t){}configureColumns(t){}};var A=class{constructor(t,e){this.registry=t,this.pageController=e,this.form=null}getForm(){return this.form}create(){this.form.show()}async edit(t){this.form.show(this.pageController.table.getRowData(t))}async updateRecord(t){await this.registry.db.add(this.registry.store,t)}async createRecord(t){await this.registry.db.update(this.registry.store,t)}async submit(){let t=this.form.getData();t.id?await this.createRecord(t):(delete t.id,await this.updateRecord(t)),this.form.resetAndHide(),await this.pageController.refresh()}};Object.keys(T).forEach(o=>{window[o]=T[o]});})();
